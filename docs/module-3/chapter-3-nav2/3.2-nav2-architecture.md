---
title: Nav2 Architecture for Humanoid Navigation
description: Detailed exploration of the Navigation Stack 2 architecture and its adaptation for humanoid robot navigation
sidebar_position: 2
---

# 3.2 Nav2 Architecture for Humanoid Navigation

## Overview

The Navigation Stack 2 (Nav2) architecture provides a comprehensive framework for autonomous navigation in robotic systems. Built on ROS 2, Nav2 offers a modular, flexible, and robust solution for navigation tasks. For humanoid robots, this architecture requires specific adaptations to address the unique challenges of bipedal locomotion and dynamic stability.

The Nav2 architecture consists of several interconnected components that work together to enable safe and efficient navigation. Understanding this architecture is crucial for implementing navigation systems that can handle the complexities of humanoid robot operation.

## Core Architecture Components

### Navigation Server

The Navigation Server serves as the central orchestrator of the Nav2 system. It manages the lifecycle of navigation tasks and coordinates between different components. Key responsibilities include:

- **Goal management**: Receiving and processing navigation goals
- **Action interface**: Providing ROS 2 action interfaces for navigation commands
- **Lifecycle management**: Controlling the state of navigation components
- **Recovery management**: Coordinating recovery behaviors when navigation fails

For humanoid robots, the Navigation Server must also handle:
- **Stability verification**: Ensuring navigation commands are compatible with balance requirements
- **Step planning coordination**: Synchronizing navigation with bipedal locomotion systems

### Planner Server

The Planner Server manages both global and local planning operations. It handles the execution of planning algorithms and provides interfaces for custom planners.

**Global Planner**:
- Generates long-term paths from start to goal positions
- Considers overall environment layout and static obstacles
- Produces optimal or near-optimal paths based on cost functions
- For humanoid robots, must account for traversability and kinematic constraints

**Local Planner**:
- Creates executable trajectories in real-time
- Handles dynamic obstacle avoidance
- Adjusts paths based on sensor feedback
- For humanoid robots, must ensure dynamic stability during execution

### Controller Server

The Controller Server manages the execution of navigation commands by converting planned trajectories into low-level robot commands. It interfaces directly with robot hardware or simulation.

Key functions include:
- **Trajectory following**: Following planned paths with precision
- **Velocity control**: Managing linear and angular velocities
- **Safety enforcement**: Ensuring safe navigation speeds and accelerations
- **Feedback processing**: Using sensor data to adjust control commands

For humanoid robots, the Controller Server must also:
- **Interface with balance controllers**: Coordinate with bipedal balance systems
- **Manage step timing**: Synchronize navigation with step execution
- **Handle multi-contact dynamics**: Account for complex humanoid kinematics

### BT Navigator

The Behavior Tree (BT) Navigator orchestrates the navigation process using behavior trees. This component provides a flexible way to define navigation behaviors and decision-making processes.

The default behavior tree includes:
- **Goal checker**: Verifying when the goal has been reached
- **Path planner**: Executing global path planning
- **Controller**: Managing local trajectory following
- **Recovery**: Executing recovery behaviors when stuck

For humanoid navigation, custom behavior trees may include:
- **Balance verification nodes**: Checking stability before proceeding
- **Step planning nodes**: Integrating with bipedal locomotion systems
- **Terrain assessment nodes**: Evaluating ground conditions

### Recovery Server

The Recovery Server manages recovery behaviors when the robot encounters navigation difficulties. These behaviors help the robot recover from situations like being stuck or unable to find a valid path.

Common recovery behaviors include:
- **Spin**: Rotating in place to clear obstacles
- **Back up**: Moving backward to find a clearer path
- **Wait**: Pausing navigation temporarily

For humanoid robots, additional recovery behaviors might include:
- **Balance recovery**: Adjusting posture before continuing
- **Step adjustment**: Modifying foot placement for stability
- **Alternative gait**: Switching to more stable locomotion patterns

## Costmap 2D Framework

The Costmap 2D framework provides a layered approach to representing the environment for navigation. It creates cost maps that guide both global and local planners.

### Static Layer
- Incorporates static map information
- Provides known obstacle locations
- For humanoid robots, may include traversability information

### Obstacle Layer
- Processes sensor data to detect obstacles
- Updates in real-time as the robot moves
- Handles both static and dynamic obstacles

### Inflation Layer
- Creates safety margins around obstacles
- Prevents the robot from getting too close to obstacles
- For humanoid robots, inflation may vary based on stability requirements

### Additional Layers for Humanoid Navigation
- **Traversability layer**: Indicates suitable terrain for bipedal locomotion
- **Stability layer**: Marks areas requiring special balance considerations
- **Step planning layer**: Precomputed foot placement options

## Parameter Configuration System

Nav2 uses a comprehensive parameter system that allows for detailed configuration of all components. Parameters are organized hierarchically and can be loaded from YAML files.

Key parameter categories include:
- **Planner parameters**: Algorithm-specific settings for path planning
- **Controller parameters**: Velocity limits, acceleration profiles, and control gains
- **Costmap parameters**: Update frequencies, sensor configurations, and inflation settings
- **Recovery parameters**: Recovery behavior thresholds and timeouts

For humanoid robots, additional parameters might include:
- **Balance constraints**: Center of mass limits and stability thresholds
- **Kinematic constraints**: Joint limits and step size restrictions
- **Gait parameters**: Walking pattern and step timing configurations

## Plugin Architecture

Nav2 implements a plugin-based architecture that allows for easy replacement and customization of components. This includes:

### Planner Plugins
- **NavFn**: Dijkstra-based path planning
- **Global Planner**: A* implementation
- **Theta\***: Any-angle path planning
- **Custom humanoid planners**: Specialized algorithms for bipedal navigation

### Controller Plugins
- **DWB Controller**: Dynamic Window Approach
- **TEB Controller**: Timed Elastic Band
- **Custom humanoid controllers**: Balance-aware trajectory following

### Recovery Plugins
- **Spin**: In-place rotation
- **Back Up**: Reverse movement
- **Wait**: Temporary pause
- **Custom humanoid recovery**: Balance-focused behaviors

## Integration with Humanoid Systems

### Robot State Interface

The Robot State Interface provides information about the robot's current state to the navigation system. For humanoid robots, this includes:

- **Joint positions**: Current configuration of all joints
- **IMU data**: Orientation and acceleration information
- **Force/torque sensors**: Ground contact and balance information
- **Odometry**: Position and velocity estimates

### TF (Transform) System

The TF system maintains coordinate frame relationships, which is crucial for humanoid navigation:

- **Base frame**: Robot's main coordinate system
- **Map frame**: Global coordinate system
- **Odom frame**: Odometry-based coordinate system
- **Sensor frames**: Positions of various sensors
- **Foot frames**: For bipedal robots, individual foot coordinate systems

### Action Interfaces

Nav2 provides ROS 2 action interfaces for navigation commands:

- **Navigation action**: Main interface for sending navigation goals
- **Follow path action**: Following predefined paths
- **Compute path to pose**: Planning without execution
- **Compute path via poses**: Planning through intermediate waypoints

## Performance Considerations

### Real-Time Requirements

Navigation systems for humanoid robots must meet strict real-time requirements:

- **Planning frequency**: Path replanning at 1-5 Hz for dynamic environments
- **Control frequency**: Trajectory following at 10-50 Hz for stability
- **Sensor processing**: Obstacle detection at 10-30 Hz depending on sensor type

### Computational Efficiency

Efficient algorithms are essential for humanoid navigation:

- **Optimized path planning**: Fast algorithms suitable for embedded systems
- **Efficient costmap updates**: Incremental updates to reduce computation
- **Parallel processing**: Utilizing multi-core systems effectively

### Memory Management

Memory usage must be carefully managed:

- **Costmap memory**: Efficient representation of environment information
- **Path storage**: Managing multiple path representations
- **Sensor data buffering**: Handling continuous sensor streams

## Safety and Reliability

### Safety Features

Nav2 includes several safety mechanisms:

- **Velocity limiting**: Preventing dangerous speeds
- **Collision prevention**: Avoiding obstacles through planning
- **Emergency stopping**: Immediate halt when needed
- **Timeout handling**: Preventing infinite loops

### Reliability Features

- **Component lifecycle**: Proper initialization and cleanup
- **Error handling**: Graceful degradation when components fail
- **Recovery mechanisms**: Automatic recovery from navigation failures

## Customization for Humanoid Robots

### Specialized Planners

Humanoid robots may require specialized planning algorithms:

- **Kinodynamic planners**: Considering both kinematic and dynamic constraints
- **Multi-level planners**: Hierarchical planning for complex environments
- **Balance-aware planners**: Incorporating stability constraints

### Custom Controllers

Controllers designed specifically for humanoid navigation:

- **Balance-aware controllers**: Maintaining stability during navigation
- **Step-based controllers**: Coordinating with footstep planning
- **Adaptive controllers**: Adjusting to different terrains

### Enhanced Costmaps

Costmaps adapted for humanoid navigation:

- **Traversability analysis**: Identifying suitable terrain for bipedal locomotion
- **Stability zones**: Marking areas requiring special balance considerations
- **Multi-height costmaps**: 3D-aware navigation for complex environments

## Integration Example

A typical Nav2 configuration for a humanoid robot might include:

```yaml
# Main navigation server configuration
bt_navigator:
  ros__parameters:
    use_sim_time: false
    global_frame: map
    robot_base_frame: base_link
    odom_topic: /odom
    bt_loop_duration: 10
    default_server_timeout: 20
    enable_groot_monitoring: true
    groot_zmq_publisher_port: 1666
    groot_zmq_server_port: 1667
    # Behavior tree XML string
    navigate_through_poses_bt_xml: navigate_through_poses_w_replanning_and_recovery.xml
    navigate_to_pose_bt_xml: navigate_to_pose_w_replanning_and_recovery.xml

# Controller server configuration
controller_server:
  ros__parameters:
    use_sim_time: false
    controller_frequency: 20.0
    min_x_velocity_threshold: 0.001
    min_y_velocity_threshold: 0.5
    min_theta_velocity_threshold: 0.001
    progress_checker_plugin: "progress_checker"
    goal_checker_plugin: "goal_checker"
    controller_plugins: ["FollowPath"]

    # DWB Controller
    FollowPath:
      plugin: "dwb_core::DWBLocalPlanner"
      debug_trajectory_details: true
      min_vel_x: 0.0
      min_vel_y: 0.0
      max_vel_x: 0.5
      max_vel_y: 0.0
      max_vel_theta: 1.0
      min_speed_xy: 0.0
      max_speed_xy: 0.5
      min_speed_theta: 0.0
      # Add safety limits for humanoid balance
      acc_lim_x: 2.5
      acc_lim_y: 0.0
      acc_lim_theta: 3.2
      decel_lim_x: -2.5
      decel_lim_y: 0.0
      decel_lim_theta: -3.2
      vx_samples: 20
      vy_samples: 0
      vtheta_samples: 40
      sim_time: 1.7
      linear_granularity: 0.05
      angular_granularity: 0.025
      transform_tolerance: 0.2
      xy_goal_tolerance: 0.25
      yaw_goal_tolerance: 0.25
      stateful: true
      shorten_transformed_plan: true
      oscillation_reset_dist: 0.05
      oscillation_reset_angle: 0.0
      costmap_weight: 2.0
      reverse_poses_to_correct_for_global_plan: true
      allow_unknown: true
      latch_xy_goal_tolerance: false
      # Humanoid-specific parameters
      balance_margin: 0.1  # Safety margin for balance
      max_tilt_angle: 15.0  # Maximum acceptable tilt

# Global planner configuration
global_costmap:
  global_costmap:
    ros__parameters:
      update_frequency: 1.0
      publish_frequency: 1.0
      global_frame: map
      robot_base_frame: base_link
      use_sim_time: false
      robot_radius: 0.3  # For humanoid, may need to adjust for foot placement
      resolution: 0.05
      track_unknown_space: true
      plugins: ["static_layer", "obstacle_layer", "inflation_layer", "traversability_layer"]
      obstacle_layer:
        plugin: "nav2_costmap_2d::ObstacleLayer"
        enabled: true
        observation_sources: scan
        scan:
          topic: /scan
          max_obstacle_height: 2.0
          clearing: true
          marking: true
          data_type: "LaserScan"
          raytrace_max_range: 3.0
          raytrace_min_range: 0.0
          obstacle_max_range: 2.5
          obstacle_min_range: 0.0
      static_layer:
        plugin: "nav2_costmap_2d::StaticLayer"
        map_subscribe_transient_local: true
      inflation_layer:
        plugin: "nav2_costmap_2d::InflationLayer"
        cost_scaling_factor: 3.0
        inflation_radius: 0.55
      traversability_layer:
        plugin: "custom_layers::TraversabilityLayer"
        # Humanoid-specific traversability parameters
        max_slope: 15.0  # Maximum traversable slope in degrees
        min_step_height: -0.1  # Minimum step-down height
        max_step_height: 0.15  # Maximum step-up height
  always_send_full_costmap: true

local_costmap:
  local_costmap:
    ros__parameters:
      update_frequency: 5.0
      publish_frequency: 2.0
      global_frame: odom
      robot_base_frame: base_link
      use_sim_time: false
      rolling_window: true
      width: 6
      height: 6
      resolution: 0.05
      robot_radius: 0.3
      plugins: ["obstacle_layer", "voxel_layer", "inflation_layer"]
      obstacle_layer:
        plugin: "nav2_costmap_2d::ObstacleLayer"
        enabled: true
        observation_sources: scan
        scan:
          topic: /scan
          max_obstacle_height: 2.0
          clearing: true
          marking: true
          data_type: "LaserScan"
          raytrace_max_range: 3.0
          raytrace_min_range: 0.0
          obstacle_max_range: 2.5
          obstacle_min_range: 0.0
      voxel_layer:
        plugin: "nav2_costmap_2d::VoxelLayer"
        enabled: true
        publish_voxel_map: true
        origin_z: 0.0
        z_resolution: 0.2
        z_voxels: 8
        max_obstacle_height: 2.0
        mark_threshold: 0
        observation_sources: pointcloud
        pointcloud:
          topic: /pointcloud
          max_obstacle_height: 2.0
          clearing: true
          marking: true
          data_type: "PointCloud2"
          min_obstacle_height: 0.0
          obstacle_max_range: 3.0
          obstacle_min_range: 0.0
          raytrace_max_range: 4.0
          raytrace_min_range: 0.0
      inflation_layer:
        plugin: "nav2_costmap_2d::InflationLayer"
        cost_scaling_factor: 3.0
        inflation_radius: 0.55
  always_send_full_costmap: false
```

## Learning Objectives

After studying this section, students should be able to:

1. Understand the modular architecture of Nav2 and its components
2. Configure Nav2 parameters for humanoid robot navigation
3. Implement custom plugins for humanoid-specific navigation needs
4. Integrate Nav2 with humanoid robot control systems
5. Evaluate the performance and safety of navigation implementations

## References

1. Navigation Stack 2 (Nav2) Architecture Documentation. (2023). ROS 2 Documentation. https://navigation.ros.org/architecture/index.html
2. Jung, D., et al. (2020). Nav2: A Framework for Behavior-Based Navigation in ROS 2. IEEE Robotics & Automation Magazine, 27(4), 108-119.
3. ROS 2 Navigation Working Group. (2023). Nav2 Configuration Guide. Retrieved from https://github.com/ros-planning/navigation2
4. Kuffner, J., & LaValle, S. M. (2000). RRT-connect: An efficient approach to single-query path planning. Proceedings of ICRA 2000.

---

This document was generated as part of the AI-Native Textbook on Physical AI & Humanoid Robotics. For more information, visit the project repository.